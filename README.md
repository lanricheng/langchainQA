# 基于langchain和ChatGLM的知识库问答

* 这是一个 langchain + ChatGLM-6B 实现方案的简化版本，可以实现文档增强的大模型问答
* ChatGLM-6B使用了int4量化，embedding模型选择了text2vec-large-chinese
* 可以在8G显存的2070 Super显卡，16G内存的windows系统上运行
* 后续可能会添加更多的llm，chain或者vector_searcher的支持

### **效果**
* 大模型问答
```commandline
result = QAChain.get_llm_answer('夏天电动车车主的烦恼是什么')  
print(result)

--------------------------------------------------------------------

夏天电动车车主可能会面临以下烦恼：

1. 高温：电动车在高温环境下行驶，可能会导致电池寿命缩短、电机性能下降等问题。因此，电动车车主可能会担心在高温季节行驶会对其车辆造成损坏。

2. 充电问题：电动车需要充电才能行驶，但在某些地区，可能没有足够的公共充电站或充电站存在充电不足或充电时间过长的问题。

3. 停车问题：电动车通常需要停车在户外，这可能会带来一些烦恼，例如停车位不足、充电设施位置不足等问题。

4. 交通安全问题：电动车通常比汽车小，因此电动车车主可能会担心在道路上行驶会对其车辆和行人造成损坏或危险。

电动车车主在夏天可能会面临一些充电、停车和交通安全方面的挑战，需要采取措施来解决这些问题。
```
* 知识库文档（支持txt，pdf，jpg，MD等格式文件）
```commandline
夏天电动车主烦恼越来越多了。

一个是充电费用大涨，电动车本来的使用成本优势越来越不明显了。

自7月以来，包括郑州，上海、青岛、重庆等地也出现了使用充电桩费用上涨的情况，部分地区高峰涨幅甚至达到87%。与平日最便宜的“深夜阶段”相比，充电费用涨幅接近1倍。电动车最大的一个卖点就在于日常的补能费用比油车低很多。而如今充电费用大幅上涨，让不少电动车用户要直呼用不起电动车了。

以上海地区某第三方充电站为例，同一地点、同一时间段，过去充电桩的价格为1.15元/度，而现在却涨到了2.15元/度，涨幅高达87%。我们在中午时间段打开各加电App后发现，充电价格基本已高达1.7-2.4元/度之间。

为了省点钱，很多车主卡着谷电去充，甚至驱车到充电成本较低的郊区充电。最近网络也新生了2个新词来形容他们，一个是“充电桩刺客”，一个是“充电特种兵”。

在最近新能源汽车的电费猝不及防地迎来上涨后，很多人开始质疑，这是不是在“养熟了割韭菜”？

如果说充电费用大涨的烦恼主要是城市里，那么电动车主们出去旅游散心，长途自驾呢？又遇到充电难的问题，尤其是偏远一点的地方，而且还遇到其他品牌“霸占”充电桩的事情。

最近，一位车主驾驶纯电动车在从克拉玛依到赛里木湖这段440公里的旅途中，发现仅有蔚来的充电桩，但蔚来又限制了他品牌在高峰时期的充电，导致这位车主为了“省电”支撑完全程，只能以25公里/小时的速度“龟速”前进，然后坚持到了一个加油站进行充电才勉强完成了整段旅程。这位车主在网上发文，引发了网络上的高度热议。

本来，蔚来愿意去建设较为偏远地区充电站，平时淡季也会有亏损，类似的品牌方承建（或者说承包）充电站的情况不止蔚来一家，这也让广大电动车主担心公共区域的充电站是否被这些品牌跑马圈地，以后被它们自家品牌车主霸占？
```

* 知识库增强大模型问答
```commandline
result = QAChain.get_knowledge_based_answer('夏天电动车车主的烦恼是什么')
print(result['result'])
    
--------------------------------------------------------------------

夏天电动车车主的烦恼是充电费用大涨，长途自驾需要支付更高的费用，公共区域充电站被品牌跑马圈地，导致车主担心充电不便利。
```

### **1、创建环境**
```commandline
python = 3.10.13
torch = 2.0.1
langchain = 0.0.287
transformers = 4.29.1
```
### **2、下载模型，修改配置**
```commandline
修改 config.py
```

### **3、测试运行**
```commandline
python main.py
```

### **文件结构**
```commandline
langchainqa
- chain
------ documentqa.py
- logs
------ log_config.py
- model
------ llm
------------------- ChatGLM-6B
----------------------------------------- config.json
----------------------------------------- pytorch_model-00001-of-00008.bin
----------------------------------------- ...
------ wordembedding
------------------- text2vec-large-chinese
------------------------------------------ config.json
------------------------------------------ pytorch_model.bin
------------------------------------------ vocab.txt
- utils
------ __init__.py
------ loader
------ textsplitter
- vector_store
------ docs
------ kb
------ vs
- config.py
- main.py
- README.md
```